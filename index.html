<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cincinnati Chess Club</title>

    <!-- Stylesheets ------------------------------------------------------------------>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
    <script src="https://cdn.jsdelivr.net/npm/tailwindcss-cdn@3.4.10/tailwindcss.js"></script>

    <!-- Full Calendar ---------------------------------------------------------------->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
</head>

<body style="overflow: hidden;">

    <!-- Navbar ----------------------------------------------------------------------->
    <nav class="navbar is-fixed-top" style="max-width: 100vw;" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="absolute top-0 left-0" href="https://bulma.io"></a>
            <img style="width: 55px; height: 55px;" src="image.png">
            </a>

            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false"
                data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div id="navbarBasicExample" class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item">
                    About
                </a>

                <a class="navbar-item">
                    Contact
                </a>

            </div>

            <div class="navbar-end">
                <div class="navbar-item">
                    <div class="buttons">
                        <a href="https://www.paypal.com/webapps/hermes?token=7XW44579NJ164331J&useraction=commit&rm=1&wpsFlowRedirectToXorouterSkipHermesStartTime=1725909261474&flowType=WPS&mfid=1725909261278_f6224498529fb"
                            class="button is-light">
                            Get Membership
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <img style="all: revert; opacity: 0.25; object-fit: cover; max-width: auto; height: 100%;"
        src="https://cdn.pixabay.com/photo/2017/09/08/20/29/chess-2730034_1280.jpg">


    <div style="position: absolute; bottom: 2vh; right: 2vw; max-width: 100vw;">
        &copy; Cincinnati Chess Club All Rights Reserved.
    </div>
    <!-- Hero page -------------------------------------------------------------------->
    <section class="section" style="position: absolute; top: 25%">
        <div>
            <h1 class="title is-size-1">Welcome to the Cincinnati Chess Club</h1>
            <p class="subtitle">We host weekly meetings to
                promote the game of chess in the Cincinnati area by offering a place to play, hosting tournaments, and
                promoting the United States Chess Federation</p>
            <a href="">learn more</a>
        </div>
        <br><br><br><br><br><br><br><br><br><br><br>


        <!-- Highlight Post -------------------------------------------------------------->
        <div id="posts">
        </div>

        <br><br><br>

        <div id='calendar'></div>

    </section>



    <!-- Logic -------------------------------------------------------------------------->

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // Get all "navbar-burger" elements
            const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

            // Add a click event on each of them
            $navbarBurgers.forEach(el => {
                el.addEventListener('click', () => {

                    // Get the target from the "data-target" attribute
                    const target = el.dataset.target;
                    const $target = document.getElementById(target);

                    // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
                    el.classList.toggle('is-active');
                    $target.classList.toggle('is-active');

                });
            });

            // Function to create event posts
            function createEventPosts(csvData) {
                // Parse CSV data
                const rows = csvData.split('\n').map(row => row.split(','));
                const headers = rows[0];
                const events = rows.slice(1).map(row => {
                    return headers.reduce((obj, header, index) => {
                        obj[header] = row[index];
                        return obj;
                    }, {});
                });

                // Helper function to format date
                function formatDate(dateString) {
                    const [month, day, year] = dateString.split('/');
                    return new Date(year, month - 1, day).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                }

                console.log(events);
                insertEventIntoPosts(events);

                // Function to find the next event within a week and format it
                function findAndFormatNextEvent(events) {
                    const currentDate = new Date();
                    const oneWeekFromNow = new Date(currentDate.getTime() + 7 * 24 * 60 * 60 * 1000);

                    // Find the next event within a week
                    const nextEvent = events.find(event => {
                        const eventDate = new Date(event.date);
                        console.log(eventDate, currentDate, oneWeekFromNow);
                        return eventDate >= currentDate && eventDate <= oneWeekFromNow;
                    });

                    if (nextEvent.length >= 2) {
                        nextEvent = nextEvent[0];
                    }

                    if (!nextEvent) {
                        return "No events found within the next week.";
                    }

                    // Format the event
                    const formattedEvent = `
        <div class="bg-black rounded-xl shadow-md overflow-hidden mt-4 md:w-2xl">
            <div class="lg:flex">
                <div class="md:flex-shrink-0">
                    <img class="h-48 w-full object-cover md:w-60"
                        src="${nextEvent.image}"
                        alt="${nextEvent.title}">
                </div>
                <div class="p-5" style="position: relative;">
                    <p style="position:absolute; top: 5px">Our Next Event</p>
                    <h1 class="title mt-2">
                        <mark class="px-2 pb-1 text-white bg-blue-800 rounded dark:bg-blue-900">${nextEvent.title}</mark>
                        <div class="text-sm text-gray-400 mt-4 ml-2">
                            ${nextEvent.description}
                        </div>
                        <div class="flex items-center ml-2 mt-2">
                            <svg class="h-4 w-4 text-gray-500 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor" width="30" height="30">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <div class="flex items-center"></div>
                            <span class="text-sm text-gray-500">${nextEvent.date}</span>
                            <span class="text-sm text-gray-700 mx-2">${nextEvent.time_start} - ${nextEvent.time_end}</span>
                        </div>
                        <div class="flex items-center mx-2">
                            <a href="${nextEvent.location}" target="_blank"
                                class="flex items-center text-blue-500 hover:text-blue-600">
                                <svg class="h-4 w-4 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor" width="30" height="30">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                                <span class="text-sm">Location</span>
                            </a>
                        </div>
                    </h1>
                </div>
            </div>
        </div>
    `;

                    return formattedEvent;
                }

                // Function to insert the formatted event into the DOM
                async function insertEventIntoPosts(events) {
                    const formattedEvent = await findAndFormatNextEvent(events);
                    const postsDiv = document.getElementById('posts');

                    if (postsDiv) {
                        postsDiv.innerHTML = formattedEvent;
                    } else {
                        console.error("Couldn't find the 'posts' div");
                    }
                }
            }

            // Function to load data and create event posts
            function loadDataAndCreatePosts() {
                var sheet_id = "2PACX-1vQSR2L38yt9rcX5YNlczXe55AIQKdbqqvzjP_3jM_nj94jBR74VmpwfwwuEue_j9M9FsnRbSwO0ffeb";
                var url = `https://docs.google.com/spreadsheets/d/e/${sheet_id}/pub?gid=0&single=true&output=csv`;

                fetch(url)
                    .then(response => response.text())
                    .then(data => {
                        const eventPostsHTML = createEventPosts(data);
                        document.getElementById('posts').innerHTML = eventPostsHTML;
                    })
                    .catch(error => console.error('Error:', error));
            }

            // Call the function to load data and create posts
            loadDataAndCreatePosts();

        });
    </script>

    <script>

        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth'
            });
            calendar.render();
        });

    </script>

</body>


</html>

<!-- 
function createEventPosts(data) {
    // Parse the data string to extract the actual data object
    const startIndex = data.indexOf('{');
    const endIndex = data.lastIndexOf('}') + 1;
    const jsonData = JSON.parse(data.slice(startIndex, endIndex));
  
    // Helper function to format date
    function formatDate(dateString) {
      const date = new Date(dateString.slice(5, -1));
      return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    }
  
    // Helper function to format time
    function formatTime(timeString) {
      const time = new Date(timeString.slice(5, -1));
      return time.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
    }
  
    // Generate HTML for all events
    const eventsHTML = jsonData.table.rows.map(event => `
      <div class="max-w-2xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden my-8">
        <img 
          src="${event.c[5].v}" 
          alt="${event.c[3].v}" 
          class="w-full h-64 object-cover"
        >
        <div class="p-6">
          <h2 class="text-2xl font-bold mb-2 text-gray-800">${event.c[3].v}</h2>
          <p class="text-gray-600 mb-4">${event.c[4].v}</p>
          <div class="flex items-center mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 text-gray-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span class="text-gray-700">${formatDate(event.c[0].v)}</span>
          </div>
          <div class="flex items-center mb-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 text-gray-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span class="text-gray-700">${formatTime(event.c[1].v)} - ${formatTime(event.c[2].v)}</span>
          </div>
          <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 text-gray-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <span class="text-gray-700">Location: ${event.c[6].v}</span>
          </div>
        </div>
      </div>
    `).join('');
  
    // Wrap all events in a container
    return `
      <div class="bg-gray-100 min-h-screen py-8">
        ${eventsHTML}
      </div>
    `;
  }
  
  // Usage
  const data = '/*O_o*/google.visualization.Query.setResponse({"version":"0.6","reqId":"0","status":"ok","sig":"1474455435","table":{"cols":[{"id":"A","label":"date","type":"date","pattern":"m/d/yyyy"},{"id":"B","label":"time_start","type":"datetime","pattern":"h:mm"},{"id":"C","label":"time_end","type":"datetime","pattern":"h:mm"},{"id":"D","label":"title","type":"string"},{"id":"E","label":"description","type":"string"},{"id":"F","label":"image","type":"string"},{"id":"G","label":"location","type":"number","pattern":"General"}],"rows":[{"c":[{"v":"Date(2024,8,12)","f":"9/12/2024"},{"v":"Date(1899,11,30,18,0,0)","f":"18:00"},{"v":"Date(1899,11,30,22,0,0)","f":"22:00"},{"v":"Conga-Line Chess"},{"v":"chaos"},{"v":"https://media.istockphoto.com/id/479708026/vector/conga-line.jpg?s=612x612&w=0&k=20&c=N7aHirqSdp6NyvHx4j-aSm5Lclpe3BnWsBYYJ-Ju5qk="},{"v":7650.0,"f":"7650"}]}],"parsedNumHeaders":1}});';
  
  document.body.innerHTML = createEventPosts(data); -->